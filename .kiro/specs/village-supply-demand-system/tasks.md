# 実装計画

- [x] 1. 村経済システムの基盤インターフェースを作成
  - VillageEconomyインターフェースを定義し、生産・消費・ストック・建物・需給状況のプロパティを含める
  - SupplyDemandConfigインターフェースを作成し、人口・建物・需給バランス関連の設定値を定義
  - 既存のVillageインターフェースを拡張してeconomyプロパティを追加
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 2. VillageEconomyManagerクラスを実装
  - 村の経済状況を更新するupdateVillageEconomyメソッドを作成
  - 生産能力を計算するcalculateProductionメソッドを実装
  - 消費量を計算するcalculateConsumptionメソッドを実装
  - 需給バランスを評価するevaluateSupplyDemandメソッドを実装
  - _要件: 1.1, 5.1, 5.2, 6.1, 6.2_

- [x] 3. PopulationManagerクラスを実装
  - 食料消費による人口変化を処理するupdatePopulationメソッドを作成
  - 人口1人当たりの食料消費量を計算するcalculateFoodConsumptionメソッドを実装
  - 食料不足時の人口増加停止ロジックを実装
  - 食料枯渇時の人口減少ロジックを実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4. BuildingManagerクラスを実装
  - 人口に基づく建物建設を処理するupdateBuildingsメソッドを作成
  - 人口に比例した目標建物数を計算するcalculateTargetBuildingCountメソッドを実装
  - 建物1つあたりの木材・鉱石コストを計算するcalculateBuildingCostメソッドを実装
  - 資源不足時の建物建設制限ロジックを実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 5. 需給バランス評価システムを実装
  - 各資源の余剰・不足状況を判定するSupplyDemandBalancerクラスを作成
  - 資源ごとの需給状況（surplus/balanced/shortage/critical）を計算
  - 村間の資源バランス比較機能を実装
  - 資源不足村と余剰村の識別機能を実装
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 6. 村の経済システムを既存の村更新ロジックに統合
  - 既存のupdateVillages関数を拡張して経済システムを組み込む
  - 時間ベースの人口変化と建物建設を実装
  - 既存の資源収集システムとの連携を確保
  - 村の状態整合性チェック機能を追加
  - _要件: 1.4, 2.1, 3.1_

- [x] 7. 資源不足表示UIシステムを実装
  - VillageStatusUIクラスを作成して資源不足情報を表示
  - 各村の資源不足状況をテキストで表示する機能を実装
  - リアルタイムで資源状況を更新する機能を実装
  - 複数村の不足情報を整理して表示する機能を実装
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 8. 設定システムとデフォルト値を実装
  - SupplyDemandConfigのデフォルト設定値を定義
  - 人口当たりの食料消費量、建物建設コスト等の調整可能な設定を実装
  - 需給バランス判定の閾値設定を実装
  - 設定値の妥当性検証機能を実装
  - _要件: 2.1, 3.1, 6.1_

- [x] 9. エラーハンドリングとデータ整合性を実装
  - 村の経済データの整合性チェック機能を実装
  - 負の値や範囲外の値の自動修正機能を実装
  - 計算エラー（ゼロ除算、NaN等）の処理を実装
  - エラーログとリカバリー機能を実装
  - _要件: 全要件の安定性確保_

- [x] 10. 包括的なテストスイートを作成
  - VillageEconomyManager、PopulationManager、BuildingManagerのユニットテストを作成
  - 人口変化と建物建設の統合テストを作成
  - 資源不足シナリオのテストケースを作成
  - UI表示とリアルタイム更新のテストを作成
  - _要件: 全要件の検証_

- [x] 11. パフォーマンス最適化と最終統合
  - 大量の村での処理性能を最適化
  - UI更新頻度の調整とバッチ処理の実装
  - メモリ使用量の最適化
  - 全システムの統合テストと最終調整
  - _要件: 全要件の統合と最適化_