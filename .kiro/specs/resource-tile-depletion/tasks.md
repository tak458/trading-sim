# 実装計画

- [x] 1. Tileインターフェースに資源消耗プロパティを追加
  - TileタイプにmaxResources、depletionState、recoveryTimer、lastHarvestTimeプロパティを追加
  - マップ生成時に新しいプロパティを適切なデフォルト値で初期化するよう更新
  - 既存のタイル作成ロジックとの後方互換性を確保
  - _要件: 1.1, 2.3_

- [x] 2. 消耗と回復ロジック用のResourceManagerクラスを作成
  - 設定サポート付きのResourceManagerクラスを実装
  - タイル資源を減少させ消耗状態を更新するharvestResourceメソッドを追加
  - 時間ベースの資源再生用のupdateRecoveryメソッドを実装
  - 消耗・回復率を含む資源設定インターフェースを作成
  - _要件: 1.1, 1.2, 2.1, 2.2, 2.4_

- [x] 3. 村の収集システムを資源消耗対応に更新
  - 村の資源収集をResourceManager.harvestResourceを呼び出すよう修正
  - 村が利用可能な資源のみ収集できるよう確保（現在量を超えない）
  - 部分的な資源利用可能性を処理する収集ロジックを更新
  - 村が採取する際の適切な資源消耗追跡を追加
  - _要件: 1.1, 1.3, 1.4, 4.1, 4.2_

- [x] 4. 資源回復システムを実装
  - メインゲームループに回復タイマー更新を追加
  - タイルタイプに基づく異なる回復率を実装（森林は木材回復が早いなど）
  - 完全に枯渇したタイルの回復遅延を追加
  - 回復中に資源が最大値を超えないよう確保
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 5. 視覚的資源状態システムを作成
  - タイル外観を計算するResourceManagerのgetVisualStateメソッドを実装
  - 透明度、色調、消耗インジケーター用のResourceVisualStateインターフェースを追加
  - 色・透明度変化で資源消耗を示す視覚レンダリングロジックを作成
  - 資源状態を視覚的に反映するようマップレンダリングを更新
  - _要件: 3.1, 3.2, 3.3_

- [x] 6. 神の介入インターフェースを実装
  - メインシーンでタイル選択用のクリック・タッチ処理を追加
  - DivineUIStateインターフェースと管理システムを作成
  - 直接的な資源修正用のResourceManagerのdivineInterventionメソッドを実装
  - 資源調整用のUIコントロール（増加・減少・特定量設定）を追加
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [x] 7. 資源情報表示を追加
  - タイル選択時に表示する詳細資源情報パネルを作成
  - 現在の資源、最大資源、回復状況を表示
  - 正確な資源量を示すホバー・クリックツールチップを追加
  - 詳細資源表示モードの切り替えを実装
  - _要件: 3.4_

- [x] 8. 設定システムを実装
  - 調整可能な消耗・回復率を持つResourceConfigインターフェースを作成
  - ゲームバランス調整用の設定UIまたは定数を追加
  - 無効な設定を防ぐための設定値バリデーションを実装
  - バランスの取れたゲームプレイを提供するデフォルト設定値を追加
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 9. 資源利用可能性に基づく村の効率を更新
  - 収集範囲内の資源不足を考慮するよう村の成長ロジックを修正
  - 資源が枯渇した際の効率低下を実装
  - 村が利用可能な資源タイプを優先するロジックを追加
  - 近隣の全資源が枯渇した際の村の成長停滞を確保
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 10. 資源システムの包括的テストを追加
  - ResourceManagerメソッド（採取、回復、神の介入）のユニットテストを作成
  - 村と資源の相互作用の統合テストを作成
  - エッジケース（資源ゼロ、最大資源、無効入力）のテストを追加
  - 多数の消耗タイルを持つ大きなマップのパフォーマンステストを実装
  - _要件: 全要件の検証_

- [x] 11. 全システムを統合しユーザー体験を向上
  - 全ての新システムと既存コードのスムーズな統合を確保
  - 資源状態変化のスムーズな視覚遷移を追加
  - 適切なエラーハンドリングとユーザーフィードバックを実装
  - リアルタイム資源更新のパフォーマンスを最適化
  - _要件: 全要件の統合_