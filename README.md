# Trade & Growth Simulator

ランダムに生成された大陸上で、村が資源を収集し、交易によって発展していく過程を眺めるシミュレーションゲーム。  
道は村同士を結び、交通量に応じて発展し、都市の成長を支える仕組みを持ちます。  

---

## 🌍 ゲーム概要
- マップは **2D タイルベース** の俯瞰表示。  
- 村は資源を集め、交易で資源をやり取りしながら発展していく。  
- プレイヤーは基本的に直接介入せず、**資源や土地条件（神視点）** のみを操作可能。  
- 道は交通に応じて進化し、村から町、都市へと発展していく姿を観察できる。  
- **需要と供給システム** により、村の人口に基づく資源消費と建物建設が実装済み。  

---

## 🏞 マップとタイル
- マップはグリッド形式のタイル。  
- 各タイルの種類：
  - **平地** - 食料を生産（5-19単位）
  - **森** - 木材を生産（0-9単位）
  - **山** - 鉱石を生産（0-9単位）
  - **水域** - 資源なし
  - **道路** - 村間の交易路
- 各タイルには **移動コスト** が設定される。
  - 道路タイル：低コスト
  - 森・山：高コスト
  - 水域：通行不可または超高コスト
- 既存の道路や近隣に道路がある場合はコストを下げ、再利用を促す。
- **資源消耗システム** により、タイルの資源は採取により減少し、時間経過で回復する。

---

## 🏘 村（Village）
- 村はマップ上に配置される拠点。  
- **人口** を持ち、人口に比例して資源を消費する。
  - **食料** → 人口に比例して毎ターン消費（1人当たり0.2単位/時間）
  - **木材・鉱石** → 建物建設で消費（建物1つにつき木材10、鉱石5）
  - **建物数** は人口に比例して増加（人口10人につき1建物）
- **需要と供給システム** により、各村の資源状況を管理：
  - 生産・消費・ストック情報をリアルタイム追跡
  - 食料不足時は人口増加停止、枯渇時は人口減少
  - 建設資源不足時は建物建設停止
  - 資源状況は「余剰・均衡・不足・危機」の4段階で評価  

---

## 🛣 道路生成
### 1. 初期敷設
- **Delaunay 三角分割**で村間の接続候補を決定。  

### 2. 経路決定（コスト最適化）
- 候補ごとにタイルコストを考慮した経路を敷設する。  
- 流れ：
  1. 直線サンプリングで概算コストを計算  
  2. 妥当なら **コリドー制約付き A\*** を実行し、直線に近い低コスト経路を求める  
  3. 経路が確定したら道路タイルとして設定  

### 3. 道路グラフ
- 敷設した道路は **グラフ構造** に変換される。
  - ノード：交差点・端点・カーブ
  - エッジ：ノード間の道路区間
- 今後の経路探索や交易はこの道路グラフを利用。

---

## 📦 交易システム
- 村同士で資源を輸送できる。  
- 交易経路は **道路グラフを用いた最短経路** で決定される。  
- 輸送時間は道路経路の総コストに比例。  
- **需給バランス** に基づく自動交易：
  - 資源余剰村から不足村への自動輸送
  - 村間の需給関係をリアルタイム評価
- 可視化（予定）：
  - 村間を結ぶ線で輸送を表示
  - 資源アイコンやラインの太さで種類や量を表現  

---

## ✅ 実装済み機能
- **資源消耗システム** - タイルの資源が採取により減少し、時間経過で回復
- **需要と供給システム** - 村ごとの生産・消費・ストック管理
- **人口ベース消費** - 人口に比例した食料消費と人口変化
- **建物建設システム** - 人口に基づく建物建設と資源消費
- **神の介入機能** - プレイヤーによる直接的な資源調整
- **リアルタイム監視** - 村の状況をリアルタイムで表示

## 🚀 今後の拡張予定
- 道路生成を完全にグラフ方式へ移行（タイル探索を不要に）。  
- 交易や村の成長をより視覚的に表現（UI、アニメーション）。  
- 環境音や BGM の導入（箱庭感を高める）。  
- 高度な交易戦略とAI村長システム。  

---

## 🛠 技術スタック
- **TypeScript**
- **Vite**（開発環境）
- **HTML5 Canvas**（描画）
- 経路探索：カスタム A\* アルゴリズム  
- 公開方法：GitHub Pages  

---

## 🎮 操作方法
- **R** - 村の収集範囲表示切り替え
- **D** - 神の介入モード切り替え
- **I** - 詳細資源情報表示切り替え
- **V** - 村の状況表示切り替え
- **P** - パフォーマンス監視表示切り替え
- **T** - 時間表示切り替え
- **H** - ヘルプ表示切り替え
- **マウスホイール** - ズーム
- **中クリック+ドラッグ** - カメラパン
- **Z** - カメラリセット

## 📖 開発手順
```bash
# 依存関係をインストール
npm install

# 開発サーバー起動
npm run dev

# ビルド
npm run build
